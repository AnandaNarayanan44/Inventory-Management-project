{% extends 'base.html' %}
{% block body %}

<!-- Main Content -->
<div class="main-container">
    <h1 class="page-title">Inventory Overview</h1>

    <!-- Summary Cards -->
    <div class="stats-grid">
        <div class="stat-card primary">
            <div class="stat-label">Total Products in Stock</div>
            <div class="stat-value">{{ stats.total_stock }}</div>
        </div>
        <div class="stat-card warning">
            <div class="stat-label">Low Stock Items</div>
            <div class="stat-value">{{ stats.low_stock }}</div>
        </div>
        <div class="stat-card danger">
            <div class="stat-label">Out of Stock Products</div>
            <div class="stat-value">{{ stats.out_of_stock }}</div>
        </div>
        <div class="stat-card success">
            <div class="stat-label">Total Categories</div>
            <div class="stat-value">{{ stats.total_categories }}</div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a class="btn-custom btn-primary-custom"  href="{% url 'addStock' %}">
            <i class="fas fa-plus"></i> Add Stock
        </a>
        <a class="btn-custom btn-success-custom"  href="{% url 'reduceStock' %}">
            <i class="fas fa-minus"></i> Reduce Stock
        </a>
        <a  class="btn-custom btn-outline-custom" href="{% url 'addSupplier' %}">
            <i class="fas fa-truck"></i> Add Supplier
        </a>
        <a href="{% url 'warehouse_management' %}" class="btn-custom btn-outline-custom">
            <i class="fas fa-warehouse"></i> Add Warehouse
        </a>
        <a href="{% url 'billing' %}" class="btn-custom btn-outline-custom">
            <i class="fas fa-file-invoice-dollar"></i> Billing
        </a>
        <a href="{% url 'inventory_reports' %}" class="btn-custom btn-outline-custom">
            <i class="fas fa-chart-bar"></i> View Reports
        </a>
    </div>

    <!-- Inventory Table -->
    <div class="table-section">
        <div class="table-header">
            <h2 class="table-title">Inventory Items</h2>
            <input type="text" class="search-input" placeholder="Search..." id="searchInput">
        </div>

        <div style="overflow-x: auto;">
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Stock Level</th>
                        <th>Location</th>
                        <th>Supplier</th>
                        <th>Expiry Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in inventory_items %}
                    <tr class="{% if item.quantity_on_hand == 0 %}out-of-stock{% elif item.quantity_on_hand < item.low_stock_threshold %}low-stock{% elif item.is_expired %}expired{% endif %}">
                        <td><strong>{{ item.product.name }}</strong><br><small>{{ item.product.category }}</small></td>
                        <td>
                            <span class="badge-stock {% if item.quantity_on_hand == 0 %}badge-out{% elif item.quantity_on_hand < item.low_stock_threshold %}badge-low{% else %}badge-high{% endif %}">
                                {{ item.quantity_on_hand }} units
                            </span>
                            <div class="helper-text">Threshold: {{ item.low_stock_threshold }}</div>
                        </td>
                        <td>{{ item.warehouse.name }}</td>
                        <td>{% if item.supplier %}{{ item.supplier.name }}{% else %}N/A{% endif %}</td>
                        <td {% if item.is_expired %}style="color: var(--danger-color); font-weight: 600;"{% endif %}>
                            {{ item.expiry_date|default:"N/A" }}
                            {% if item.is_expired %}(EXPIRED){% endif %}
                        </td>
                        <td>
                            <a href="{% url 'editInventoryItem' item.id %}" class="btn-icon btn-edit">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="{% url 'deleteInventoryItem' item.id %}" class="btn-icon btn-delete" onclick="return confirm('Are you sure you want to delete this item?')">
                                <i class="fas fa-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem; color: #64748b;">
                            No inventory items found. Add stock to get started.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Stock Modal -->
<div class="modal fade" id="addStockModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus-circle"></i> Add Stock</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'addStock' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Product <span style="color: red;">*</span></label>
                        <select class="form-select" name="product" required>
                            <option value="">Select a product</option>
                            {% for product in products %}
                            <option value="{{ product.id }}">{{ product.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Quantity <span style="color: red;">*</span></label>
                        <input type="number" class="form-control" name="quantity" placeholder="Enter quantity" min="1" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Barcode <span style="color: red;">*</span></label>
                        <input type="text" class="form-control" name="barcode" placeholder="Scan or type barcode" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Warehouse <span style="color: red;">*</span></label>
                        <select class="form-select" name="warehouse" required>
                            <option value="">Select warehouse</option>
                            {% for warehouse in warehouses %}
                            <option value="{{ warehouse.id }}">{{ warehouse.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Supplier</label>
                        <select class="form-select" name="supplier">
                            <option value="">Select supplier (optional)</option>
                            {% for supplier in suppliers %}
                            <option value="{{ supplier.id }}">{{ supplier.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Expiry Date</label>
                        <input type="date" class="form-control" name="expiry_date">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Stock</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Reduce Stock Modal -->
<div class="modal fade" id="reduceStockModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-minus-circle"></i> Reduce Stock (Sale)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'reduceStock' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Product <span style="color: red;">*</span></label>
                        <select class="form-select" name="product" required>
                            <option value="">Select a product</option>
                            {% for product in products %}
                            <option value="{{ product.id }}">{{ product.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Warehouse <span style="color: red;">*</span></label>
                        <select class="form-select" name="warehouse" required>
                            <option value="">Select warehouse</option>
                            {% for warehouse in warehouses %}
                            <option value="{{ warehouse.id }}">{{ warehouse.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Quantity Sold <span style="color: red;">*</span></label>
                        <input type="number" class="form-control" name="quantity" placeholder="Enter quantity" min="1" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Sale Price</label>
                        <input type="number" class="form-control" name="sale_price" step="0.01" min="0">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Customer Name</label>
                        <input type="text" class="form-control" name="customer_name" placeholder="Customer">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Sale Date <span style="color: red;">*</span></label>
                        <input type="date" class="form-control" name="sale_date" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Reason <span style="color: red;">*</span></label>
                        <select class="form-select" name="reason" required>
                            <option value="sale">Sale</option>
                            <option value="damage">Damage</option>
                            <option value="expired">Expired</option>
                            <option value="theft">Theft</option>
                            <option value="return">Return to Supplier</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" name="notes" rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Reduce Stock</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Simple search functionality
    document.getElementById('searchInput').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('.inventory-table tbody tr');
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    });

    document.querySelectorAll('input[name="sale_date"]').forEach(input => {
        if (!input.value) {
            input.value = new Date().toISOString().split('T')[0];
        }
    });
</script>

{% endblock body %}